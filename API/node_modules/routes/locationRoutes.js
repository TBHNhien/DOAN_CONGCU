const express = require('express');
const Location = require('../models/Location'); // Đảm bảo đường dẫn đến mô hình Location đúng
const router = express.Router();

// Lưu vị trí mới
router.post('/location', (req, res) => {
  const location = new Location({
    latitude: req.body.latitude,
    longitude: req.body.longitude
  });

  location.save().then(result => res.send(result));
});

// Lấy lịch sử vị trí
router.get('/locations', (req, res) => {
  Location.find().then(results => res.send(results));
});

// Lấy lịch sử di chuyển trong vòng 1 giờ qua
router.get('/history', async (req, res) => {
  try {
    const currentTime = new Date();
    const oneHourAgo = new Date(currentTime.getTime() - (60 * 60 * 1000));

    const history = await Location.find({
      timestamp: { $gte: oneHourAgo }
    });

    res.json(history);
  } catch (err) {
    console.error('Error getting history:', err);
    res.status(500).json({ message: 'Internal server error' });
  }
});

module.exports = router;
